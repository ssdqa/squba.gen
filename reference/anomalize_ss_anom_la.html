<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>STL Regression Anomaly Detection — anomalize_ss_anom_la • squba.gen</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="STL Regression Anomaly Detection — anomalize_ss_anom_la"><meta name="description" content="For Single Site, Anomaly Detection, Longitudinal analyses where the time_period is
smaller than a year, this function will execute timetk::anomalize() to identify
outliers in the time series using STL regression. For year-level analyses, the same
input table will be returned and a different anomaly detection method will be used at
the *_output stage"><meta property="og:description" content="For Single Site, Anomaly Detection, Longitudinal analyses where the time_period is
smaller than a year, this function will execute timetk::anomalize() to identify
outliers in the time series using STL regression. For year-level analyses, the same
input table will be returned and a different anomaly detection method will be used at
the *_output stage"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">squba.gen</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="external-link nav-link" href="https://ssdqa.github.io/squba/">squba Home</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ssdqa/squba.gen/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>STL Regression Anomaly Detection</h1>
      <small class="dont-index">Source: <a href="https://github.com/ssdqa/squba.gen/blob/main/R/anomaly_detection.R" class="external-link"><code>R/anomaly_detection.R</code></a></small>
      <div class="d-none name"><code>anomalize_ss_anom_la.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>For Single Site, Anomaly Detection, Longitudinal analyses where the <code>time_period</code> is
smaller than a year, this function will execute <code><a href="https://business-science.github.io/timetk/reference/anomalize.html" class="external-link">timetk::anomalize()</a></code> to identify
outliers in the time series using STL regression. For year-level analyses, the same
input table will be returned and a different anomaly detection method will be used at
the *_output stage</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">anomalize_ss_anom_la</span><span class="op">(</span><span class="va">fot_input_tbl</span>, <span class="va">grp_vars</span>, <span class="va">time_var</span>, <span class="va">var_col</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-fot-input-tbl">fot_input_tbl<a class="anchor" aria-label="anchor" href="#arg-fot-input-tbl"></a></dt>
<dd><p><em>tabular input</em> || <strong>required</strong></p>
<p>A table, typically output by <code><a href="compute_fot.html">compute_fot()</a></code></p></dd>


<dt id="arg-grp-vars">grp_vars<a class="anchor" aria-label="anchor" href="#arg-grp-vars"></a></dt>
<dd><p><em>string or vector</em> || <strong>required</strong></p>
<p>The variable(s) to be used as grouping variables in the analysis. These
variables will also be preserved in the cross-join, meaning there should
not be any NAs as an artifact of the join for these variables.</p></dd>


<dt id="arg-time-var">time_var<a class="anchor" aria-label="anchor" href="#arg-time-var"></a></dt>
<dd><p><em>string</em> || <strong>required</strong></p>
<p>The variable with the time period date information (typically <code>time_start</code>)</p></dd>


<dt id="arg-var-col">var_col<a class="anchor" aria-label="anchor" href="#arg-var-col"></a></dt>
<dd><p><em>string</em> || <strong>required</strong></p>
<p>The variable with the numerical statistic of interest for the euclidean
distance computation</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>For yearly analyses, the same input table will be returned and the anomaly
detection method will be executed via a control chart in the *_output step.
For smaller time increments, this function will return the input dataframe
with all columns from the original input table plus the columns needed for
timetk output generated by the <code>anomalize</code> function. These include an anomaly
indicator and variables related to the decomposition of the time series.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># sample single-site, longitudinal input data (modeled after EVP)</span></span></span>
<span class="r-in"><span><span class="va">sample_ss_la_input</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="st">'variable'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'scd'</span>, <span class="st">'scd'</span>, <span class="st">'scd'</span>,</span></span>
<span class="r-in"><span>                                                   <span class="st">'scd'</span>, <span class="st">'scd'</span>, <span class="st">'scd'</span>,</span></span>
<span class="r-in"><span>                                                   <span class="st">'scd'</span>, <span class="st">'scd'</span>, <span class="st">'scd'</span>,</span></span>
<span class="r-in"><span>                                                   <span class="st">'scd'</span>, <span class="st">'scd'</span>, <span class="st">'scd'</span>,</span></span>
<span class="r-in"><span>                                                   <span class="st">'scd'</span>, <span class="st">'scd'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             <span class="st">'site'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Site A'</span>,<span class="st">'Site A'</span>,<span class="st">'Site A'</span>,</span></span>
<span class="r-in"><span>                                        <span class="st">'Site A'</span>,<span class="st">'Site A'</span>,<span class="st">'Site A'</span>,</span></span>
<span class="r-in"><span>                                        <span class="st">'Site A'</span>,<span class="st">'Site A'</span>,<span class="st">'Site A'</span>,</span></span>
<span class="r-in"><span>                                        <span class="st">'Site A'</span>,<span class="st">'Site A'</span>,<span class="st">'Site A'</span>,</span></span>
<span class="r-in"><span>                                        <span class="st">'Site A'</span>,<span class="st">'Site A'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             <span class="st">'count'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">24</span>, <span class="fl">100</span>, <span class="fl">93</span>, <span class="fl">47</span>, <span class="fl">65</span>,</span></span>
<span class="r-in"><span>                                         <span class="fl">33</span>, <span class="fl">92</span>, <span class="fl">153</span>, <span class="fl">122</span>, <span class="fl">5</span>, <span class="fl">99</span>,</span></span>
<span class="r-in"><span>                                         <span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             <span class="st">'time_start'</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'2018-01-01'</span>, <span class="st">'2018-02-01'</span>,</span></span>
<span class="r-in"><span>                                <span class="st">'2018-03-01'</span>, <span class="st">'2018-04-01'</span>, <span class="st">'2018-05-01'</span>,</span></span>
<span class="r-in"><span>                                <span class="st">'2018-06-01'</span>, <span class="st">'2018-07-01'</span>, <span class="st">'2018-08-01'</span>,</span></span>
<span class="r-in"><span>                                <span class="st">'2018-09-01'</span>, <span class="st">'2018-10-01'</span>, <span class="st">'2018-11-01'</span>,</span></span>
<span class="r-in"><span>                                <span class="st">'2018-12-01'</span>, <span class="st">'2019-01-01'</span>, <span class="st">'2019-02-01'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                             <span class="st">'time_increment'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'month'</span>,<span class="st">'month'</span>,<span class="st">'month'</span>,</span></span>
<span class="r-in"><span>                                   <span class="st">'month'</span>, <span class="st">'month'</span>,<span class="st">'month'</span>, <span class="st">'month'</span>,<span class="st">'month'</span>,</span></span>
<span class="r-in"><span>                                   <span class="st">'month'</span>,<span class="st">'month'</span>,<span class="st">'month'</span>,<span class="st">'month'</span>,<span class="st">'month'</span>,</span></span>
<span class="r-in"><span>                                   <span class="st">'month'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># execute 'anomalization' from timetk package to find anomalies</span></span></span>
<span class="r-in"><span><span class="fu">anomalize_ss_anom_la</span><span class="op">(</span>fot_input_tbl <span class="op">=</span> <span class="va">sample_ss_la_input</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>                         <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">time_start</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     grp_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'site'</span>,<span class="st">'variable'</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     time_var <span class="op">=</span> <span class="st">'time_start'</span>,</span></span>
<span class="r-in"><span>                     var_col <span class="op">=</span> <span class="st">'count'</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(time_start, site, variable)`</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> frequency = 3 observations per 1 quarter</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> trend = 14 (Number of observations insufficient for shorter trend cycles.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Joining with `by = join_by(time_start, site, variable)`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 14 × 16</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    time_start site   variable count time_increment observed season trend</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> 2018-01-01 Site A scd         15 month                15  -<span style="color: #BB0000;">12.1</span>  44.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> 2018-02-01 Site A scd         24 month                24  -<span style="color: #BB0000;">24.7</span>  50.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> 2018-03-01 Site A scd        100 month               100   36.8  55.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> 2018-04-01 Site A scd         93 month                93  -<span style="color: #BB0000;">12.1</span>  61.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> 2018-05-01 Site A scd         47 month                47  -<span style="color: #BB0000;">24.7</span>  67.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> 2018-06-01 Site A scd         65 month                65   36.8  72.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> 2018-07-01 Site A scd         33 month                33  -<span style="color: #BB0000;">12.1</span>  76.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> 2018-08-01 Site A scd         92 month                92  -<span style="color: #BB0000;">24.7</span>  74.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> 2018-09-01 Site A scd        153 month               153   36.8  71.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> 2018-10-01 Site A scd        122 month               122  -<span style="color: #BB0000;">12.1</span>  67.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">11</span> 2018-11-01 Site A scd          5 month                 5  -<span style="color: #BB0000;">24.7</span>  64.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">12</span> 2018-12-01 Site A scd         99 month                99   36.8  60.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">13</span> 2019-01-01 Site A scd         10 month                10  -<span style="color: #BB0000;">12.1</span>  56.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">14</span> 2019-02-01 Site A scd         30 month                30  -<span style="color: #BB0000;">24.7</span>  51.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 8 more variables: remainder &lt;dbl&gt;, seasadj &lt;dbl&gt;, anomaly &lt;chr&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   anomaly_direction &lt;dbl&gt;, anomaly_score &lt;dbl&gt;, recomposed_l1 &lt;dbl&gt;,</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;">#   recomposed_l2 &lt;dbl&gt;, observed_clean &lt;dbl&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hanieh Razzaghi, Kaleigh Wieand, Kimberley Dickinson, Charles Bailey.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

